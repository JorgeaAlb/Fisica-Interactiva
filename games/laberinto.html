<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laberinto Gravitatorio</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Estilos generales */
        :root {
            --color-primary: #3498db;
            --color-secondary: #e74c3c;
            --color-success: #2ecc71;
            --color-dark: #2c3e50;
            --color-light: #ecf0f1;
            --color-text: #333;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--color-text);
            background-color: #f5f7fa;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        
        

        /* Menú hamburguesa */
        .hamburger-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Contenido principal */
        .container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 1rem;
            flex: 1;
        }

        .back-btn {
            display: inline-block;
            margin-bottom: 20px;
            padding: 8px 16px;
            background-color: #f0f0f0;
            color: #333;
            text-decoration: none;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .back-btn:hover {
            background-color: #e0e0e0;
        }

        .game-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 3px 24px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            padding: 25px;
        }

        .game-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .game-header h1 {
            color: var(--color-dark);
            font-size: 28px;
            margin-bottom: 10px;
        }

        .game-header p {
            color: var(--color-text);
        }

        /* Canvas del juego */
        /* Canvas del juego */
        .game-canvas-container {
        position: relative;
        width: 100%;
        max-width: 600px; /* Máximo ancho para evitar que se estire demasiado */
        margin: 20px auto;
        background-color: #f8f9fa;
        border-radius: 10px;
        border: 2px solid #ddd;
        overflow: hidden;
        }

        #gravityMaze {
            display: block;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            background-color: #f0f8ff;
        }

        /* Controles de gravedad - Nuevo diseño tipo pad */
        .gravity-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
        }

        .control-row {
            display: flex;
            justify-content: center;
            margin: 5px 0;
        }

        .gravity-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--color-primary);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin: 0 10px;
        }

        .gravity-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .gravity-btn:active {
            transform: scale(0.95);
        }

        .gravity-btn.zero {
            background-color: var(--color-dark);
            display: none;
            margin: 10px 0;
        }

        /* Información del juego */
        .game-info {
        display: none;
        justify-content: space-around;
        margin-top: 20px;
        padding: 15px;
        background-color: rgba(52, 152, 219, 0.1);
        border-radius: 8px;
        flex-wrap: wrap;
        gap: 15px;
    }

    .game-stat {
        text-align: center;
        min-width: 80px;
        padding: 10px;
        flex: 1;
    }

    .game-stat h3 {
        color: var(--color-dark);
        margin-bottom: 5px;
        font-size: 16px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .game-stat p {
        font-size: 24px;
        font-weight: bold;
        color: var(--color-primary);
        margin: 0;
    }

        /* Niveles */
        .level-selector {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .level-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background-color: var(--color-light);
            color: var(--color-dark);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .level-btn.active {
            background-color: var(--color-primary);
            color: white;
        }

        .level-btn:hover:not(.active) {
            background-color: #d6eaf8;
        }

        /* Footer */
        footer {
            background-color: var(--color-dark);
            color: white;
            text-align: center;
            padding: 1.5rem;
            margin-top: auto;
        }

        .footer-content p {
            margin-bottom: 0.5rem;
        }

        /* Mensaje para móviles */
        .mobile-warning {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(3px);
        }

        .warning-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            max-width: 90%;
            width: 400px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .warning-icon {
            font-size: 50px;
            margin-bottom: 15px;
            color: var(--color-primary);
        }

        .warning-content h3 {
            color: var(--color-dark);
            margin-bottom: 10px;
        }

        .warning-content p {
            color: var(--color-text);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .btn-continue {
            background: linear-gradient(135deg, var(--color-primary), #2980b9);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 30px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-continue:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* Efectos de feedback */
        .game-feedback {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            font-weight: 600;
            border-radius: 8px;
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        .feedback-success {
            background-color: rgba(46, 204, 113, 0.15);
            color: var(--color-success);
            display: block;
        }

        .feedback-error {
            background-color: rgba(231, 76, 60, 0.15);
            color: var(--color-secondary);
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Estilos responsivos */
        @media (max-width: 768px) {
            /* Menú hamburguesa */
            .hamburger-btn {
                display: block;
                background: none;
                border: none;
                color: white;
                font-size: 1.5rem;
                cursor: pointer;
                margin-left: auto;
                padding: 0.5rem;
            }

            /* Oculta el menú normal en móvil */
            nav ul {
                display: none;
                list-style: none;
            }

            /* Menú desplegable activo */
            nav ul.active {
                display: flex;
                flex-direction: column;
                position: absolute;
                top: 70px;
                right: 20px;
                background-color: var(--color-dark); /* Cambiado a color oscuro sólido */
                border-radius: 5px;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
                width: 200px;
                padding: 1rem 0;
                z-index: 1000;
            }

            nav ul.active li {
                padding: 0.5rem 1.5rem;
                text-align: left;
                margin: 0; /* Elimina el margen izquierdo que tenía antes */
            }

            nav ul.active li:hover {
                background-color: rgba(255, 255, 255, 0.1);
            }

            nav ul.active li a {
                color: white;
                width: 100%;
            }


            .container {
                padding: 10px;
            }

            .game-container {
                padding: 15px;
            }

            .game-header h1 {
                font-size: 24px;
            }

            .game-canvas-container {
                height: 100%;
                width: 100%;
            }

            .gravity-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
                margin: 0 5px;
            }

            @media (max-width: 768px) {
        .game-info {
            flex-direction: row; /* Mantenemos en fila pero con wrap */
            padding: 10px;
            gap: 10px;
        }

        .game-stat {
            min-width: 30%;
            padding: 8px 5px;
            flex: none;
        }

        .game-stat h3 {
            font-size: 14px;
        }

        .game-stat p {
            font-size: 20px;
        }
    }

    @media (max-width: 480px) {
        .game-stat {
            min-width: 28%;
        }

        .game-stat h3 {
            font-size: 12px;
        }

        .game-stat p {
            font-size: 18px;
        }
    } }
    .computadora-warning {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    display: flex;  /* Se muestra de forma modal */
    justify-content: center;
    align-items: center;
    z-index: 2000; /* Por encima de todo el contenido */
    backdrop-filter: blur(3px);
}

/* Control de volumen */
.volume-control {
    display: none;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-top: 1rem;
}

.volume-control i {
    color: #3498db;
}
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <a href="../home.html" class="logo">
                <i class="fas fa-atom"></i>
                <span>Física Interactiva</span>
            </a>
            <button class="hamburger-btn" aria-label="Menú">
                <i class="fas fa-bars"></i>
            </button>
            <nav>
                <ul>
                    <li><a href="../home.html"><i class="fas fa-home"></i> Inicio</a></li>
                    <li><a href="../games.html"><i class="fas fa-gamepad"></i> Mini Juegos</a></li>
                    <li><a href="../calculator.html"><i class="fas fa-calculator"></i> Calculadora</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <!-- Mensaje para móviles -->
        <div id="mobile-warning" class="mobile-warning">
            <div class="warning-content">
                <div class="warning-icon">📱</div>
                <h3>Experiencia optimizada para computadora</h3>
                <p>Este juego funciona mejor en pantallas grandes. Puedes continuar en móvil, pero algunos elementos podrían no verse perfectamente.</p>
                <button id="continue-mobile" class="btn btn-continue">Entendido, jugar igual</button>
            </div>
        </div>
        
        <!-- Mensaje para computadoras -->
        <div id="computadora-warning" class="computadora-warning">
            <div class="warning-content">
                <div class="warning-icon">💡</div>
                <h3>Usa las flechas del teclado para jugar</h3>
                <p>Utiliza las flechas para controlar la gravedad y guiar la bola.</p>
                <button id="continue-game" class="btn btn-continue">Entendido, comenzar</button>
            </div>
        </div>

        <a href="../games.html" class="back-btn">
            <i class="fas fa-arrow-left"></i> Volver a todos los juegos
        </a>
        
        <div class="game-container">
            <div class="game-header">
                <h1></i> Laberinto Gravitatorio</h1>
                <p>Controla la gravedad para guiar la bola hasta la meta</p>
            </div>

            <div class="level-selector">
                <button class="level-btn active" data-level="1">Nivel 1</button>
                <button class="level-btn" data-level="2">Nivel 2</button>
                <button class="level-btn" data-level="3">Nivel 3</button>
                <button class="level-btn" data-level="4">Nivel 4</button>
                <button class="level-btn" data-level="5">Nivel 5</button>
                <button class="level-btn" data-level="6">Nivel 6</button>
            </div>

            <div class="game-canvas-container">
                <canvas id="gravityMaze"></canvas>
            </div>

            <!-- Nuevo diseño de controles tipo pad -->
            <div class="gravity-controls">
                <div class="control-row">
                    <button class="gravity-btn" id="gravityUp" title="Gravedad arriba">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                </div>
                <div class="control-row">
                    <button class="gravity-btn" id="gravityLeft" title="Gravedad izquierda">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <button class="gravity-btn zero" id="gravityZero" title="Sin gravedad">
                        <i class="fas fa-times"></i>
                    </button>
                    <button class="gravity-btn" id="gravityRight" title="Gravedad derecha">
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                <div class="control-row">
                    <button class="gravity-btn" id="gravityDown" title="Gravedad abajo">
                        <i class="fas fa-arrow-down"></i>
                    </button>
                </div>
            </div>

            <!-- Control de volumen -->
            <div class="volume-control">
                <i class="fas fa-volume-up"></i>
                <input type="range" min="0" max="1" step="0.1" value="0.7" id="volumeSlider">
            </div>

            <div class="game-info">
                <div class="game-stat">
                    <h3>Tiempo</h3>
                    <p id="timeDisplay">00:00</p>
                </div>
                <div class="game-stat">
                    <h3>Intentos</h3>
                    <p id="attemptsDisplay">0</p>
                </div>
                <div class="game-stat">
                    <h3>Nivel</h3>
                    <p id="levelDisplay">1</p>
                </div>
            </div>

            <div class="game-feedback" id="gameFeedback"></div>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <p>© 2025 Jorge Alberto · Física Interactiva · Todos los derechos reservados.</p>
        </div>
    </footer>  

    <script>
    // Precargar sonidos
    const soundSuccess = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3');
    const soundError = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3');
    const soundMove = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3');
    
    // Configurar sonidos
    [soundSuccess, soundError, soundMove].forEach(sound => {
        sound.preload = 'auto';
        sound.volume = 0.7;
    });

    // Función para reproducir sonidos
    function playSound(sound) {
        try {
            sound.currentTime = 0; // Rebobinar antes de reproducir
            const playPromise = sound.play();
            
            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.log("Reproducción automática prevenida:", error);
                    // Activar sonidos con interacción del usuario
                    document.body.addEventListener('click', function handler() {
                        sound.play();
                        document.body.removeEventListener('click', handler);
                    }, { once: true });
                });
            }
        } catch (e) {
            console.log("Error con sonido:", e);
        }
    }
        
    document.addEventListener('DOMContentLoaded', function() {
    // Elementos del DOM
    const canvas = document.getElementById('gravityMaze');
    const ctx = canvas.getContext('2d');
    const timeDisplay = document.getElementById('timeDisplay');
    const attemptsDisplay = document.getElementById('attemptsDisplay');
    const levelDisplay = document.getElementById('levelDisplay');
    const gameFeedback = document.getElementById('gameFeedback');
    const levelButtons = document.querySelectorAll('.level-btn');
    const gravityBtns = {
        up: document.getElementById('gravityUp'),
        left: document.getElementById('gravityLeft'),
        down: document.getElementById('gravityDown'),
        right: document.getElementById('gravityRight'),
        zero: document.getElementById('gravityZero')
    };
    const mobileWarning = document.getElementById('mobile-warning');
    const continueBtn = document.getElementById('continue-mobile');
    const hamburgerBtn = document.querySelector('.hamburger-btn');
    const nav = document.querySelector('nav');
    const computadoraWarning = document.getElementById('computadora-warning');
    const continueGameBtn = document.getElementById('continue-game');
    const volumeSlider = document.getElementById('volumeSlider');

    // Control de volumen
    volumeSlider.addEventListener('input', function() {
        const volume = parseFloat(this.value);
        soundSuccess.volume = volume;
        soundError.volume = volume;
        soundMove.volume = volume;
    });

    // Mostrar alerta de computadora solo en pantallas grandes
    if (window.innerWidth > 768) {
        computadoraWarning.style.display = 'flex';
    } else {
        computadoraWarning.style.display = 'none';
    }
    
    // Mostrar alerta de móvil solo en dispositivos pequeños
    if (window.innerWidth <= 768) {
        mobileWarning.style.display = 'flex';
    } else {
        mobileWarning.style.display = 'none';
    }

    // Ocultar alerta de computadora al hacer clic
    continueGameBtn.addEventListener('click', function() {
        computadoraWarning.style.display = 'none';
        // Activar sonidos con la primera interacción del usuario
        soundSuccess.play().then(() => soundSuccess.pause()).catch(e => console.log(e));
        soundError.play().then(() => soundError.pause()).catch(e => console.log(e));
        soundMove.play().then(() => soundMove.pause()).catch(e => console.log(e));
    });

    

    // Variables del juego
    let gravity = { x: 0, y: 0.5 };
    let ball = { x: 50, y: 50, radius: 10, velocity: { x: 0, y: 0 } };
    let currentLevel = 1;
    let levels = [];
    let currentMaze = [];
    let goal = { x: 0, y: 0, width: 20, height: 20 };
    let gameRunning = true;
    let startTime = Date.now();
    let attempts = 0;
    let animationId = null;
    let cellSize = 0;
    let mazeWidth = 0, mazeHeight = 0;
    let offsetX = 0, offsetY = 0;

    // Configuración de niveles
    function initLevels() {
    levels = [
        { // Nivel 1
            maze: [
                [1, 1, 1, 1, 1, 1, 1, 1],
                [1, 0, 0, 1, 0, 0, 0, 1],
                [1, 0, 1, 1, 0, 1, 0, 1],
                [1, 0, 1, 0, 0, 1, 0, 1],
                [1, 0, 1, 0, 1, 1, 0, 1],
                [1, 0, 1, 0, 1, 0, 0, 1],
                [1, 0, 0, 0, 1, 2, 1, 1],
                [1, 1, 1, 1, 1, 1, 1, 1]
            ],
            start: { x: 2, y: 1 },
            gravity: 0.5
        },

        { // Nivel 2
            maze: [
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1],
                [1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1],
                [1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1],
                [1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1],
                [1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1],
                [1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1],
                [1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1],
                [1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 2, 0, 0, 0, 0, 0, 0, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
            ],
            start: { x: 1, y: 9 },
            gravity: 0.6
        },

        { // Nivel 3
            maze: [
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1],
                [1, 0, 1, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1],
                [1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1],
                [1, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1],
                [1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1],
                [1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1],
                [1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1],
                [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 2, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
            ],
            start: { x: 1, y: 5 },
            gravity: 0.7
        },
        { // Nivel 4 (más difícil)
            maze: [
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 1, 0, 1, 1, 1, 1, 1],
                [1, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0, 1, 0, 0, 1],
                [1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1],
                [1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 1],
                [1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],
                [1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1],
                [1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1],
                [1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1],
                [1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1],
                [1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0, 1],
                [1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1],
                [1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 1],
                [1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1],
                [1, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1],
                [1, 2, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
            ],
            start: { x: 1, y: 1 },
            gravity: 0.8
        },
        { // Nivel 5
            maze: [
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1],
                [1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1],
                [1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1],
                [1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 1],
                [1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1],
                [1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1],
                [1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1],
                [1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1],
                [1, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1],
                [1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1],
                [1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1],
                [1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1, 1],
                [1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1],
                [1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1],
                [1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1],
                [1, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1],
                [1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 2, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
            ],
            start: { x: 1, y: 1 },
            gravity: 0.8
        },
        { // Nivel 6 (el más difícil)
            maze: [
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                [1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1],
                [1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1],
                [1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1],
                [1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1],
                [1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1],
                [1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1],
                [1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1],
                [1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],
                [1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1],
                [1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 2, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],
                [1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1],
                [1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1],
                [1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1],
                [1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1],
                [1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1],
                [1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1],
                [1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1],
                [1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                [1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
            ],
            start: { x: 5, y: 3 },
            gravity: 1
        }
    ];
}

    // Inicializar el juego
    function initGame() {
        initLevels();
        loadLevel(currentLevel);
        setupControls();
        setupMobileMenu();
        updateGameInfo();
        gameLoop();

        // Añadir event listener para redimensionamiento
        window.addEventListener('resize', handleResize);
    }

    // Manejar redimensionamiento
    function handleResize() {
        if (animationId) {
            cancelAnimationFrame(animationId);
        }
        loadLevel(currentLevel);
        gameLoop();
    }

    // Configurar el canvas
    function setupCanvas() {
    const container = document.querySelector('.game-canvas-container');
    const containerWidth = container.clientWidth;
    
    // El canvas toma el ancho del contenedor y la altura se calcula según la proporción del laberinto
    canvas.width = containerWidth;
    canvas.height = containerWidth * (mazeHeight / mazeWidth);
    
    // Calcular tamaño de celda sin restar un margen fijo para aprovechar más el espacio
    cellSize = Math.min(
        (canvas.width) / mazeWidth, 
        (canvas.height) / mazeHeight
    );
    
    // Calcular offsets para centrar el laberinto
    offsetX = (canvas.width - mazeWidth * cellSize) / 2;
    offsetY = (canvas.height - mazeHeight * cellSize) / 2;
}

    // Cargar nivel
    function loadLevel(levelNum) {
        currentLevel = levelNum;
        const level = levels[levelNum - 1];
        currentMaze = level.maze;
        
        // Calcular dimensiones del laberinto
        mazeWidth = currentMaze[0].length;
        mazeHeight = currentMaze.length;
        
        // Configurar canvas con las nuevas dimensiones
        setupCanvas();
        
        // Posicionar bola y meta
        ball.x = level.start.x * cellSize + cellSize / 2 + offsetX;
        ball.y = level.start.y * cellSize + cellSize / 2 + offsetY;
        ball.velocity = { x: 0, y: 0 };
        
        // Encontrar la meta (2 en el maze)
        for (let y = 0; y < mazeHeight; y++) {
            for (let x = 0; x < mazeWidth; x++) {
                if (currentMaze[y][x] === 2) {
                    goal.x = x * cellSize + cellSize / 2 + offsetX;
                    goal.y = y * cellSize + cellSize / 2 + offsetY;
                    break;
                }
            }
        }
        
        // Resetear gravedad
        gravity = { x: 0, y: level.gravity };
        
        // Actualizar UI
        levelDisplay.textContent = currentLevel;
        levelButtons.forEach(btn => {
            btn.classList.toggle('active', parseInt(btn.dataset.level) === currentLevel);
        });
        
        // Resetear tiempo
        startTime = Date.now();
        updateTimer();
    }

    // Bucle principal del juego
    function gameLoop() {
        if (!gameRunning) return;
        
        update();
        render();
        
        animationId = requestAnimationFrame(gameLoop);
    }

    // Actualizar estado del juego
    function update() {
        // Aplicar gravedad
        ball.velocity.x += gravity.x * 0.1;
        ball.velocity.y += gravity.y * 0.1;
        
        // Aplicar rozamiento
        ball.velocity.x *= 0.98;
        ball.velocity.y *= 0.98;
        
        // Movimiento
        const newX = ball.x + ball.velocity.x;
        const newY = ball.y + ball.velocity.y;
        
        // Detección de colisiones
        if (!checkWallCollision(newX, ball.y)) {
            ball.x = newX;
        } else {
            ball.velocity.x *= -0.5; // Rebote
            playSound(); // Sonido de colisión
        }
        
        if (!checkWallCollision(ball.x, newY)) {
            ball.y = newY;
        } else {
            ball.velocity.y *= -0.5; // Rebote
            playSound(); // Sonido de colisión
        }
        
        // Verificar si llegó a la meta
        checkGoal();
    }

    // Verificar colisión con paredes
    function checkWallCollision(x, y) {
        const cellX = Math.floor((x - offsetX) / cellSize);
        const cellY = Math.floor((y - offsetY) / cellSize);
        
        // Verificar límites
        if (cellX < 0 || cellX >= mazeWidth || cellY < 0 || cellY >= mazeHeight) {
            return true;
        }
        
        // Verificar si es pared (1)
        return currentMaze[cellY][cellX] === 1;
    }

    // Verificar si la bola llegó a la meta
    function checkGoal() {
        const distance = Math.sqrt(
            Math.pow(ball.x - goal.x, 2) + 
            Math.pow(ball.y - goal.y, 2)
        );
        
        if (distance < 15) {
            playSound(soundSuccess); // Sonido de éxito
            showFeedback(`¡Nivel ${currentLevel} completado!`, 'success');
            gameRunning = false;
            
            setTimeout(() => {
                if (currentLevel < levels.length) {
                    loadLevel(currentLevel + 1);
                    gameRunning = true;
                    gameLoop();
                } else {
                    showFeedback('¡Felicidades! Has completado todos los niveles', 'success');
                }
            }, 1500);
        }
    }

    // Renderizar el juego
    function render() {
        // Limpiar canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Dibujar laberinto
        for (let y = 0; y < mazeHeight; y++) {
            for (let x = 0; x < mazeWidth; x++) {
                if (currentMaze[y][x] === 1) { // Pared
                    ctx.fillStyle = '#34495e';
                    ctx.fillRect(
                        x * cellSize + offsetX, 
                        y * cellSize + offsetY, 
                        cellSize, 
                        cellSize
                    );
                } else if (currentMaze[y][x] === 2) { // Meta
                    ctx.fillStyle = '#2ecc71';
                    ctx.beginPath();
                    ctx.arc(
                        x * cellSize + cellSize / 2 + offsetX, 
                        y * cellSize + cellSize / 2 + offsetY, 
                        cellSize / 3, 
                        0, 
                        Math.PI * 2
                    );
                    ctx.fill();
                }
            }
        }
        
        // Dibujar bola
        ctx.fillStyle = '#e74c3c';
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
        ctx.fill();
        
        // Dibujar dirección de gravedad
        if (gravity.x !== 0 || gravity.y !== 0) {
            ctx.strokeStyle = 'rgba(52, 152, 219, 0.7)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(ball.x, ball.y);
            ctx.lineTo(
                ball.x + gravity.x * 30, 
                ball.y + gravity.y * 30
            );
            ctx.stroke();
            
            // Flecha
            const angle = Math.atan2(gravity.y, gravity.x);
            ctx.beginPath();
            ctx.moveTo(
                ball.x + gravity.x * 30, 
                ball.y + gravity.y * 30
            );
            ctx.lineTo(
                ball.x + gravity.x * 25 - Math.cos(angle - Math.PI/6) * 10,
                ball.y + gravity.y * 25 - Math.sin(angle - Math.PI/6) * 10
            );
            ctx.lineTo(
                ball.x + gravity.x * 25 - Math.cos(angle + Math.PI/6) * 10,
                ball.y + gravity.y * 25 - Math.sin(angle + Math.PI/6) * 10
            );
            ctx.closePath();
            ctx.fillStyle = 'rgba(52, 152, 219, 0.7)';
            ctx.fill();
        }
    }

    // Configurar controles
    function setupControls() {
        // Teclado
        document.addEventListener('keydown', (e) => {
            // Prevenir comportamiento por defecto de las flechas
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' '].includes(e.key)) {
                e.preventDefault();
            }
            
            switch(e.key) {
                case 'ArrowUp':
                    setGravity(0, -levels[currentLevel - 1].gravity);
                    playSound(soundMove); // Sonido de movimiento
                    break;
                case 'ArrowDown':
                    setGravity(0, levels[currentLevel - 1].gravity);
                    playSound(soundMove); // Sonido de movimiento
                    break;
                case 'ArrowLeft':
                    setGravity(-levels[currentLevel - 1].gravity, 0);
                    playSound(soundMove); // Sonido de movimiento
                    break;
                case 'ArrowRight':
                    setGravity(levels[currentLevel - 1].gravity, 0);
                    playSound(soundMove); // Sonido de movimiento
                    break;
                case ' ':
                    setGravity(0, 0);
                    playSound(soundMove); // Sonido de movimiento
                    break;
            }
        });
        
        // Botones de gravedad
        gravityBtns.up.addEventListener('click', () => {
            setGravity(0, -levels[currentLevel - 1].gravity);
            playSound(soundMove); // Sonido de movimiento
        });
        gravityBtns.down.addEventListener('click', () => {
            setGravity(0, levels[currentLevel - 1].gravity);
            playSound(soundMove); // Sonido de movimiento
        });
        gravityBtns.left.addEventListener('click', () => {
            setGravity(-levels[currentLevel - 1].gravity, 0);
            playSound(soundMove); // Sonido de movimiento
        });
        gravityBtns.right.addEventListener('click', () => {
            setGravity(levels[currentLevel - 1].gravity, 0);
            playSound(soundMove); // Sonido de movimiento
        });
        gravityBtns.zero.addEventListener('click', () => {
            setGravity(0, 0);
            playSound(soundMove); // Sonido de movimiento
        });
        
        // Botones de nivel
        levelButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                playSound(soundMove); // Sonido al cambiar de nivel
                attempts = 0;
                attemptsDisplay.textContent = attempts;
                loadLevel(parseInt(this.dataset.level));
            });
        });
    }

    // Establecer gravedad
    function setGravity(x, y) {
        gravity = { x, y };
    }

    // Mostrar mensaje de feedback
    function showFeedback(message, type) {
        gameFeedback.textContent = message;
        gameFeedback.className = 'game-feedback';
        
        if (type === 'success') {
            gameFeedback.classList.add('feedback-success');
        } else if (type === 'error') {
            gameFeedback.classList.add('feedback-error');
        }
        
        gameFeedback.style.display = 'block';
        
        setTimeout(() => {
            gameFeedback.style.display = 'none';
        }, 3000);
    }

    // Actualizar temporizador
    function updateTimer() {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
        const seconds = (elapsed % 60).toString().padStart(2, '0');
        timeDisplay.textContent = `${minutes}:${seconds}`;
        
        if (gameRunning) {
            setTimeout(updateTimer, 1000);
        }
    }

    // Actualizar información del juego
    function updateGameInfo() {
        attemptsDisplay.textContent = attempts;
        levelDisplay.textContent = currentLevel;
    }

    // Configurar menú móvil
    function setupMobileMenu() {
        hamburgerBtn.addEventListener('click', function() {
            nav.classList.toggle('active');
        });
        
        // Cerrar menú al hacer clic en enlaces
        document.querySelectorAll('nav ul li a').forEach(item => {
            item.addEventListener('click', function() {
                if (window.innerWidth <= 768) {
                    nav.classList.remove('active');
                }
            });
        });
        
        // Continuar en móvil
        continueBtn.addEventListener('click', function() {
            mobileWarning.style.display = 'none';
            // Activar sonidos con la primera interacción del usuario
            soundSuccess.play().then(() => soundSuccess.pause()).catch(e => console.log(e));
            soundError.play().then(() => soundError.pause()).catch(e => console.log(e));
            soundMove.play().then(() => soundMove.pause()).catch(e => console.log(e));
        });
    }

    // Iniciar el juego
    initGame();
});

</script>
<script>
    // Menú hamburguesa
    document.querySelector('.hamburger-btn').addEventListener('click', function() {
        document.querySelector('nav ul').classList.toggle('active');
    });
    
    // Cerrar menú al hacer clic en enlaces (solo en móvil)
    document.querySelectorAll('nav ul li a').forEach(item => {
        item.addEventListener('click', function() {
            if (window.innerWidth <= 768) {
                document.querySelector('nav ul').classList.remove('active');
            }
        });
    });
</script>
</body>
</html>